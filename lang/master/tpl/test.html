<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="/css/::getVariable('css')::/style.css"/>
    <script type="text/javascript" src="/js/::getVariable('js')::/libs.dev.js"></script>
    <script type="text/javascript" src="/js/::getVariable('js')::/app.js"></script>

    <style>
        .ablock{
            margin-bottom: 20px
        }

        .ablock pre {
            padding-top: 20px;
            padding-bottom: 20px;
            background-color: #ccc;
        }
    </style>
</head>
<body style="padding: 16px">
    <div>
        <p>Distrib #::distrib.id::</p>
        <p>Fin ::distrib.orderEndDate::</p>
    </div>

    <br />

    <div>
        <button id="reset-btn">RESET</button>
        <button id="gen-btn">GEN FAKE DATAS</button>
        <button id="close-btn">CLOSE DISTRIB</button>
        <button id="resolve-btn">RESOLVE</button>
    </div>

    <br />
    <div class="ablock">
        <h1>Actiev slot</h1>
        <div id="activate-slots-wrapper"></div>
        <pre>
            _NeolithicViewsGenerator.activateDistribSlots(HTML_ELEMENT_ID, {
                distribId: DISTRIB_ID,
                slotDuration: NUMBER_TIME,
            })
        </pre>
        <hr />
    </div>

    <div class="ablock">
        <h1>Slots selector</h1>
        <div id="users-slots-wrapper"></div>
        <pre>
            _NeolithicViewsGenerator.userDistribSlotsSelector(HTML_ELEMENT_ID, {
                distribId: DISTRIB_ID,
            }) 
        </pre>
        <hr />
    </div>

    <div class="ablock">
        <h1>Slots resolved</h1>
        <div id="slots-resolver-wrapper"></div>
        <pre>
            _NeolithicViewsGenerator.distribSlotsResolver(HTML_ELEMENT_ID, {
                distribId: DISTRIB_ID
            });
        </pre>
        <hr />
    </div>

    

    <script>
        var distribId = ::distrib.id::;
        var activated = ::distrib.slotsIsActivated::;

        function reset() {
            console.log("reset");
            fetch("http://localhost/api/distributions/"+distribId+"/desactivateSlots", {
                method: "POST"
            }).then(function(res) {
                if (!res.ok) throw new Error(res.statusText);
                document.location.reload(true);
                return res;
            }).catch(function(error) {
                console.log(error)
            })
        }

        function genDatas() {
            console.log("genDatas");
            fetch("http://localhost/api/distributions/"+distribId+"/generateFakeDatas", {
                method: "POST"
            }).then(function(res) {
                if (!res.ok) throw new Error(res.statusText);
                document.location.reload(true);
                return res;
            }).catch(function(error) {
                console.log(error)
            })
        }

        function closeDistrib() {
            console.log("closeDistrib");
            fetch("http://localhost/api/distributions/"+distribId+"/closeDistrib", {
                method: "POST"
            }).then(function(res) {
                if (!res.ok) throw new Error(res.statusText);
                document.location.reload(true);
                return res;
            }).catch(function(error) {
                console.log(error)
            })
        }

        function resolveDistrib() {
            console.log("resolve");
            fetch("http://localhost/api/distributions/"+distribId+"/resolve", {
                method: "POST"
            }).then(function(res) {
                if (!res.ok) throw new Error(res.statusText);
                document.location.reload(true);
                return res;
            }).catch(function(error) {
                console.log(error)
            })
        }

        document.getElementById("reset-btn").addEventListener("click", reset);
        document.getElementById("gen-btn").addEventListener("click", genDatas);
        document.getElementById("close-btn").addEventListener("click", closeDistrib);
        document.getElementById("resolve-btn").addEventListener("click", resolveDistrib);
    

        _NeolithicViewsGenerator.activateDistribSlots("activate-slots-wrapper", {
            distribId: ::distrib.id::,
            slotDuration: 1000 * 60 * 15,
        })

        if (activated) {        
            _NeolithicViewsGenerator.userDistribSlotsSelector("users-slots-wrapper", {
                distribId: ::distrib.id::,
            }) 
        }

        _NeolithicViewsGenerator.distribSlotsResolver("slots-resolver-wrapper", {
            distribId: ::distrib.id::
        });
        
    </script>

    <!--

    
        _NeolithicViewsGenerator.userDistribSlotsSelector("users-slots-wrapper", {
            fetchMeUrl: "http://localhost/api/user/me",
            postMeUrl: "http://localhost/api/user/me",
            postRegisterInNeedUrl: "",
            postRegisterUserSlotsUrl: "http://localhost/api/distributions/35000/registerUserSlots",
            postRegisterUserVonluntary: ,
            slots: "",
            inNeedUsers: "",
        }) 
    -->

</body>
</html>