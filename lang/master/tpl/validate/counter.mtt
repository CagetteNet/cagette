::use 'design.mtt'::
<div class="article">
<div class="row">
    
	    <div class="col-md-12">
		
			
			<div class="text-center">
				<h3>
					Encaissements
                </h3>
                <h4>
                    <i class="icon icon-calendar"></i> ::hDate(distribution.getDate())::
                </h4>	
				<h4>
					<i class="icon icon-map-marker"></i> ::distribution.getPlace().name::
				</h4>
            </div>
        </div>
        
        <div class="col-md-6">
            <table class="table table-bordered">
                <tr>
                    <td><b>Fond de caisse avant distribution</b></td>
                    <td>
                        <form method="POST">
                        <input name="counterBeforeDistrib" type="number" step="any"  value="::distribution.counterBeforeDistrib::" class="form-control" style="display: inline-block;width:100px;"/>
                        <input type="submit" value="Mettre à jour" class="btn btn-primary" style="display: inline-block"/>
                    </form>
                    </td>
                </tr>
                <tr>
                    <td> <b>Encaissements en liquide</b></td>
                    <td>::sales.cashTurnover.ttc:: &euro;</td>
                </tr>
                
               
                <tr>
                    <td>
                        <b>La caisse doit contenir</b>
                    </td>
                    <td> 
                        ::formatNum(distribution.counterBeforeDistrib + sales.cashTurnover.ttc):: &euro;
                    </td>
                </tr>

                <tr>
                    <td> <b>Encaissements en chèque</b></td>
                    <td>::sales.checkTurnover.ttc:: &euro;</td>
                </tr>

                <tr>
                    <td>
                        <b>Total Commande par taux de TVA</b>
                    </td>
                    <td>
                            <table class="table">
            
                                    <tr>
                                        <td>Taux</td>
                                        <td>HT</td>
                                        <td>TTC</td>
                                    </tr>
                                ::foreach k ordersByVat.keys()::
                                    <tr>
                                        <th>::k/100::%</th>
                                        <td>::formatNum(ordersByVat.get(k).ht)::</td>
                                        <td>::formatNum(ordersByVat.get(k).ttc)::</td>
                                    </tr>
                                ::end::
                                </table>

                    </td>
                </tr>

                
                 
              
            </table>

            
        </div>
        

        <div class="col-md-6">
                <table class="table table-bordered">
                    
                    <tr>
                        <td> <b>Commandes non payées</b></td>
                        <td>
                            ::if(notPaid.length>0)::
                                ::set total = 0.0::
                                <ul>
                                ::foreach np notPaid::
                                    <li>::np.user.getName():: : ::formatNum(np.amount):: ::currency()::</li>
                                    ::set total = total + np.amount::
                                ::end::
                                </ul>
                                Total impayé : ::formatNum(total):: ::currency()::
                            ::else::
                                Aucun
                            ::end::
                            
                        </td>
                    </tr>
                    <tr>
                        <td> <b>Commandes payées partiellement</b></td>
                        <td>
                            ::if(partiallyPaid.length>0)::
                                ::set total = 0.0::
                                <ul>
                                ::foreach b partiallyPaid::
                                    <li>::b.user.getName():: : manque ::formatNum(b.amount):: ::currency()::</li>
                                    ::set total = total + b.amount::
                                ::end::
                                </ul>
                                Total dettes : ::formatNum(total):: ::currency()::
                            ::else::
                                Aucun
                            ::end::
                            
                        </td>
    
                    </tr>
                    <tr>
                            <td> <b>Avoirs</b></td>
                            <td>
                                ::if(paidTooMuch.length>0)::
                                    ::set total = 0.0::
                                    <ul>
                                    ::foreach b paidTooMuch::
                                        <li>::b.user.getName():: : avoir de ::formatNum(b.amount):: ::currency()::</li>
                                        ::set total = total + b.amount::
                                    ::end::
                                    </ul>
                                    Total avoirs : ::formatNum(total):: ::currency()::
                                ::else::
                                    Aucun
                                ::end::
                                
                            </td>
        
                        </tr>
                    
                  
                </table>
    
                
    
                
            </div>

            <div class="col-md-12">
                    <a href="/distribution/validate/::distribution.id::" class="btn btn-default btn-sm">
                        <i class="icon icon-chevron-left"></i> Retour
                    </a>

                    $$export(?csv=1)
            </div>
            


    </div>
</div>
::end::
